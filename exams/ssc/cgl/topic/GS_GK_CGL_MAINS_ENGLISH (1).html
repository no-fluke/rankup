<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>GS  GK CGL MAINS ENGLISH</title>
<style>
:root{
  --accent:#2ec4b6;
  --accent-dark:#1da89a;
  --muted:#69707a;
  --success:#1f9e5a;
  --danger:#c82d3f;
  --warning:#f39c12;
  --info:#3498db;
  --purple:#9b59b6;
  --bg:#f5f7fa;
  --card:#fff;
  --maxw:820px;
  --radius:10px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;background:var(--bg);color:#111;padding-bottom:96px}
.container{max-width:var(--maxw);margin:auto;padding:10px 16px}
header{background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.08);position:relative;z-index:10}
.header-inner{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;gap:12px}
h1{margin:0;color:var(--accent);font-size:18px}
.btn{background:var(--accent);color:#fff;border:none;border-radius:6px;padding:8px 12px;font-size:13px;font-weight:600;cursor:pointer;transition:background .18s}
.btn:hover{background:var(--accent-dark)}
.btn-ghost{background:#fff;color:var(--accent);border:2px solid var(--accent);padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer}
.timer-text{color:var(--accent-dark);font-weight:700;font-size:18px;min-width:72px;text-align:right}
.toggle-pill{position:relative;width:90px;height:30px;background:#eaeef0;border-radius:999px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;padding:0 6px;font-size:13px;color:#444;font-weight:600}
.toggle-pill span{z-index:2;flex:1;text-align:center}
.toggle-pill::before{content:"";position:absolute;top:3px;left:3px;width:42px;height:24px;background:var(--accent);border-radius:999px;transition:.28s}
.toggle-pill.active::before{transform:translateX(45px);background:var(--accent-dark)}
.toggle-pill.active span:last-child{color:#fff}
.toggle-pill span:first-child{color:#fff}

/* quiz card */
.card{background:var(--card);border-radius:10px;padding:10px 12px;margin:12px 0;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
.qbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.qmeta{font-size:13px;color:var(--muted)}
.marking{font-size:13px;color:var(--muted)}
.qtext{font-size:16px;margin:6px 0;font-weight:500}
.opt{padding:10px;border:1px solid #e6eaec;border-radius:8px;background:#fff;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all .12s;font-weight:500}
.opt{padding:10px;border:1px solid #e6eaec;border-radius:8px;background:#fff;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all .12s}
.opt:hover{border-color:#cfd8da}
.opt.selected{border-color:var(--accent)}
.opt.correct{border-color:var(--success);background:rgba(31,158,90,0.12)}
.opt.wrong{border-color:var(--danger);background:rgba(200,45,63,0.12)}
.custom-radio{display:none;height:16px;width:16px;border-radius:50%;border:2px solid #ccc}
.opt.selected .custom-radio{display:block;border:6px solid var(--accent)}
.opt.correct .custom-radio{display:block;border:6px solid var(--success)}
.opt.wrong .custom-radio{display:block;border:6px solid var(--danger)}
.explanation{margin-top:8px;padding:10px;border-radius:8px;background:#fbfdfe;border:1px solid #edf2f3;display:none;font-size:14px}

/* bottom nav */
.fbar{position:fixed;left:0;right:0;bottom:0;background:#fff;box-shadow:0 -3px 12px rgba(0,0,0,0.08);display:flex;justify-content:center;z-index:50}
.fbar-inner{display:flex;justify-content:center;align-items:center;gap:10px;max-width:var(--maxw);width:100%;padding:10px}
.fbar button{background:var(--accent);color:#fff;border:none;border-radius:6px;padding:8px 12px;font-size:13px;font-weight:600;cursor:pointer}
.fbar button:hover{background:var(--accent-dark)}

/* palette popup */
#palette{position:fixed;top:64px;right:14px;background:#fff;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.12);padding:12px;display:none;gap:8px;flex-wrap:wrap;z-index:200;max-width:300px;max-height:70vh;overflow-y:auto;overscroll-behavior:contain}
#palette .qbtn{width:44px;height:44px;border-radius:8px;border:1px solid #e3eaeb;background:#fbfdff;cursor:pointer;font-weight:700}
#palette .qbtn.attempted{background:var(--success);color:#fff;border:none}
#palette .qbtn.unattempted{background:var(--danger);color:#fff;border:none}
#palette .qbtn.marked{background:var(--purple);color:#fff;border:none}
#palette .qbtn.current{border:3px solid var(--accent);font-weight:bold;transform:scale(1.05);box-shadow:0 0 0 2px rgba(46,196,182,0.2)}
#palette-summary{margin-top:8px;font-size:13px;color:var(--muted);text-align:center}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:300}
.modal-content{background:#fff;border-radius:12px;padding:18px;max-width:420px;width:92%;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,0.18)}
.modal h3{margin:0 0 8px;color:var(--accent)}
.modal p{color:#333;margin:8px 0 12px;font-size:15px}
.modal .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));color:#fff;border:none;padding:8px 14px;border-radius:999px;font-weight:700;cursor:pointer}

/* results */
.results{margin-top:12px}
.stats{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
.stat{flex:1 1 120px;padding:10px;border-radius:10px;text-align:center;background:#f7fbfb;border:1px solid #e6eeed}
.stat h4{margin:0;color:var(--accent);font-size:13px}
.stat p{margin:6px 0 0;font-weight:700;font-size:18px}

/* New buttons */
.btn-mark{background:var(--purple);color:#fff}
.btn-save{background:var(--info);color:#fff}
.btn-clear{background:var(--warning);color:#fff}

/* üîê COPY & SELECTION BLOCK */
body {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Allow inputs only */
input, textarea {
  user-select: text !important;
}

/* üîê WATERMARK BASE */
.ssc-watermark {
  position: fixed;
  inset: 0;
  z-index: 3;
  pointer-events: none;
  overflow: hidden;
}

.ssc-wm {
  position: absolute;
  font-size: 26px;
  font-weight: 700;
  color: rgba(0,0,0,0.045);
  transform: rotate(-30deg);
  white-space: nowrap;
}

/* Student Name Input */
#studentNameContainer {
  max-width:600px;
  margin:10px auto 20px auto;
  padding:0 16px;
  z-index: 5;
  position: relative;
}

#studentName {
  width:100%;
  padding:12px 16px;
  font-size:15px;
  border:2px solid var(--accent);
  border-radius:8px;
  background:#fff;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  transition:border-color 0.2s;
}

#studentName:focus {
  outline:none;
  border-color:var(--accent-dark);
  box-shadow:0 0 0 3px rgba(46,196,182,0.2);
}

/* üî¢ MathJax mobile safety */
mjx-container {
  max-width: 100%;
  overflow-x: auto;
}

/* üî¢ Make MathJax match quiz text font */
mjx-container {
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif !important;
  font-size: 1em;
}

/* Responsive design */
@media (max-width: 768px) {
  .header-inner {
    flex-direction: column;
    gap: 8px;
    padding: 8px;
  }
  
  .fbar-inner {
    flex-wrap: wrap;
    padding: 8px;
    gap: 6px;
  }
  
  .fbar button {
    padding: 6px 8px;
    font-size: 12px;
    flex: 1 1 80px;
  }
  
  .container {
    padding: 8px;
  }
  
  .qtext {
    font-size: 15px;
  }
  
  .opt {
    padding: 8px;
  }
  
  #palette {
    top: 120px;
    left: 50%;
    transform: translateX(-50%);
    max-width: 90%;
  }
  
  #palette .qbtn {
    width: 38px;
    height: 38px;
  }
  
  .stats {
    flex-direction: column;
  }
  
  .stat {
    flex: 1 1 auto;
  }
  
  #studentNameContainer {
    padding: 0 12px;
    margin: 8px auto 16px auto;
  }
  
  #studentName {
    padding: 10px 14px;
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  .timer-text {
    font-size: 16px;
  }
  
  h1 {
    font-size: 16px;
  }
  
  .btn, .btn-ghost {
    padding: 6px 10px;
    font-size: 12px;
  }
  
  .fbar-inner {
    gap: 4px;
  }
  
  .fbar button {
    padding: 6px;
    font-size: 11px;
  }
  
  .card {
    padding: 8px;
  }
  
  #studentName {
    padding: 8px 12px;
    font-size: 13px;
  }
}

@media (min-width: 1024px) {
  .container {
    max-width: 900px;
  }
  
  .fbar-inner {
    max-width: 900px;
  }
}

/* Tablet specific */
@media (min-width: 769px) and (max-width: 1024px) {
  .container {
    max-width: 750px;
    padding: 12px;
  }
  
  .fbar-inner {
    max-width: 750px;
  }
}

</style>

<!-- üî¢ MathJax Auto-LaTeX (Google Docs like) -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)'], ['$', '$']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      skipHtmlTags: ['script', 'style', 'textarea', 'pre']
    }
  };
</script>

<script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
  async>
</script>

<!-- üî• FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBWF7Ojso-w0BucbqJylGR7h9eGeDQodzE",
    authDomain: "ssc-quiz-rank-percentile.firebaseapp.com",
    databaseURL: "https://ssc-quiz-rank-percentile-default-rtdb.firebaseio.com",
    projectId: "ssc-quiz-rank-percentile",
    storageBucket: "ssc-quiz-rank-percentile.firebasestorage.app",
    messagingSenderId: "944635517164",
    appId: "1:944635517164:web:62f0cc83892917f225edc9"
  };

  // üî• Initialize Firebase
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  // üî• Realtime Database reference
  const db = firebase.database();
</script>

</head>
<body>

<!-- üîê WATERMARK LAYER -->
<div id="ssc-watermark" class="ssc-watermark">
  <div class="ssc-wm" style="top:10%; left:5%;">@SSC_JOURNEY2</div>
  <div class="ssc-wm" style="top:30%; left:60%;">@SSC_JOURNEY2</div>
  <div class="ssc-wm" style="top:55%; left:25%;">@SSC_JOURNEY2</div>
  <div class="ssc-wm" style="top:75%; left:65%;">@SSC_JOURNEY2</div>
  <div class="ssc-wm" style="top:90%; left:10%;">@SSC_JOURNEY2</div>
</div>

<!-- Student Name Input -->
<div id="studentNameContainer">
  <input
    type="text"
    id="studentName"
    placeholder="Enter your full name (required to submit)"
    style="width:100%;padding:12px 16px;font-size:15px;border:2px solid #2ec4b6;border-radius:8px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.1)"
  />
</div>

<!-- TELEGRAM JOIN OVERLAY WITH CLOSE BUTTON -->
<style>
  #ssc-join-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2147483647;
  }

  #ssc-join-card {
    width: min(520px, 92%);
    background: #fff;
    border-radius: 12px;
    padding: 22px 18px 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    text-align: center;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    position: relative;
  }

  #ssc-join-close {
    position: absolute;
    top: 10px;
    right: 12px;
    border: none;
    background: none;
    font-size: 20px;
    font-weight: 700;
    cursor: pointer;
    color: #555;
  }

  #ssc-join-title {
    margin: 10px 0 16px;
    font-size: 16px;
    font-weight: 800;
    color: #052d3d;
    line-height: 1.4;
  }

  .ssc-join-btn {
    display: inline-block;
    background: #0088cc;
    color: #fff;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
  }
</style>

<div id="ssc-join-overlay" aria-hidden="true" style="display: none;">
  <div id="ssc-join-card">
    <button id="ssc-join-close" aria-label="Close">‚úï</button>

    <div id="ssc-join-title">
      JOIN SSC JOURNEY TELEGRAM CHANNEL FOR MORE QUIZ AND MOCK
    </div>

    <a
      id="ssc-join-open"
      class="ssc-join-btn"
      href="https://t.me/SSC_JOURNEY2"
      target="_blank"
      rel="noopener noreferrer"
    >
      Join Channel
    </a>
  </div>
</div>

<script>
(function () {
  const OVERLAY_ID = "ssc-join-overlay";
  const OPEN_ID = "ssc-join-open";
  const CLOSE_ID = "ssc-join-close";
  const SESSION_KEY = "ssc_tg_joined_session_v1";

  const overlay = document.getElementById(OVERLAY_ID);
  const openBtn = document.getElementById(OPEN_ID);
  const closeBtn = document.getElementById(CLOSE_ID);

  if (!overlay || !openBtn || !closeBtn) return;

  function showModal() {
    overlay.style.display = "flex";
    overlay.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function hideModal() {
    overlay.style.display = "none";
    overlay.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  function sessionJoined() {
    try {
      return sessionStorage.getItem(SESSION_KEY) === "1";
    } catch (e) {
      return false;
    }
  }

  function markSessionJoined() {
    try {
      sessionStorage.setItem(SESSION_KEY, "1");
    } catch (e) {}
  }

  /* show on first interaction */
  document.addEventListener(
    "click",
    function (e) {
      if (sessionJoined()) return;
      const t = e.target;
      if (
        t.closest(".opt") ||
        t.closest("#nextBtn") ||
        t.closest("#prevBtn") ||
        t.closest("#submitBtn") ||
        t.closest("#paletteBtn") ||
        t.closest("#modeToggle")
      ) {
        e.preventDefault();
        e.stopPropagation();
        showModal();
      }
    },
    true
  );

  /* JOIN button */
  openBtn.addEventListener("click", function () {
    markSessionJoined();
    hideModal();
  });

  /* CLOSE (‚úï) button */
  closeBtn.addEventListener("click", function () {
    markSessionJoined();
    hideModal();
  });
})();

</script>

<header id="mainHeader">
  <div class="header-inner" id="headerControls">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="toggle-pill" id="modeToggle"><span>Test</span><span>Quiz</span></div>
    </div>

    <div style="display:flex;align-items:center;gap:10px">
      <div class="timer-text" id="timer">00:00</div>
      <button id="submitBtn" class="btn">Submit</button>
      <button id="paletteBtn" class="btn-ghost">View</button>
    </div>
  </div>
</header>

<div class="container">
  <div id="quizCard" class="card">
    <div class="qbar">
      <div class="qmeta">Question <span id="qindex">0</span> / <span id="qtotal">0</span></div>
      <div class="marking" id="marking"></div>
    </div>

    <div class="qtext" id="qtext"></div>
    <div class="options" id="options"></div>
    <div id="explanation" class="explanation"></div>
  </div>

  <div id="results" class="results" style="display:none"></div>
  <div id="previousAttempts" class="results" style="display:none"></div>
  <div id="attemptReplay" class="results" style="display:none"></div>

</div>

<div class="fbar" id="floatBar">
  <div class="fbar-inner">
    <button id="prevBtn">‚Üê Prev</button>
    <button id="markReviewBtn" class="btn-mark">Mark for Review</button>
    <button id="clearBtn" class="btn-clear">Clear</button>
    <button id="saveNextBtn" class="btn-save">Save & Next</button>
    <button id="nextBtn">Next ‚Üí</button>
  </div>
</div>

<div id="palette" aria-hidden="true"></div>

<div id="submitModal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Submit quiz?</h3>
    <p id="submitMsg">You attempted X/Y. Are you sure you want to submit?</p>
    <div class="actions">
      <button id="cancelSubmit" class="btn-ghost">Cancel</button>
      <button id="confirmSubmit" class="btn-primary">Submit</button>
    </div>
  </div>
</div>

<script>
function renderMath(){
  if (window.MathJax && MathJax.typesetPromise) {
    MathJax.typesetPromise();
  }
}

function normalizeMathForQuiz(container) {
  if (!container) return;

  // Replace $$...$$ inside text with inline math \( ... \)
  container.innerHTML = container.innerHTML
    // case 1: $$...$$ surrounded by text ‚Üí inline
    .replace(/(\S)\s*\$\$(.+?)\$\*\s*(\S)/g, '$1 \\($2\\) $3')
    // case 2: $$...$$ with spaces but not line-isolated ‚Üí inline
    .replace(/\$\$(.+?)\$\$/g, function(match, math) {
      // if already block (surrounded by <br> or alone), keep it
      if (/^<br>|<div>|<\/div>|<p>|<\/p>/.test(match)) {
        return match;
      }
      return '\\(' + math + '\\)';
    });
}

function _hx(s){
  let h = 0;
  for(let i = 0; i < s.length; i++){
    h = ((h << 5) - h) + s.charCodeAt(i);
    h |= 0;
  }
  return h;
}

let __QUIZ_OK = true;

// üîê SAFE Device ID (works everywhere)
let DEVICE_ID = localStorage.getItem("ssc_quiz_device_id");
if (!DEVICE_ID) {
  DEVICE_ID = "dev-" + Date.now() + "-" + Math.random().toString(36).substring(2, 12);
  localStorage.setItem("ssc_quiz_device_id", DEVICE_ID);
}

const QUIZ_TITLE = "GS  GK CGL MAINS ENGLISH";
const QUIZ_STATE_KEY = "ssc_quiz_state_GS  GK CGL MAINS ENGLISH";
const QUIZ_RESULT_KEY = "ssc_quiz_result_GS  GK CGL MAINS ENGLISH";

// Tamper detection for join section
const banner = document.getElementById("ssc-join-title");
const joinBtn = document.getElementById("ssc-join-open");

if (!banner || !joinBtn) {
  __QUIZ_OK = false;
  document.body.innerHTML = "";
  throw new Error("JOIN_COMPONENT_MISSING");
}

const EXPECTED_HASH = 197247123;  // Hash value for tamper detection

if (_hx(banner.textContent.trim() + "|" + joinBtn.href) !== EXPECTED_HASH) {
  __QUIZ_OK = false;
  document.body.innerHTML =
    "<h2 style='text-align:center;margin-top:60px;color:#c82d3f'>Quiz blocked (modified join section)</h2>";
  throw new Error("JOIN_TAMPERED");
}

// üî• FIREBASE: SAVE ONLY FIRST ATTEMPT (ADMIN DATA)
function saveResultFirebase(payload) {
  const ref = db.ref(
    "quiz_results/" + payload.quizId + "/" + payload.deviceId
  );

  return ref.once("value").then(snap => {
    if (snap.exists()) {
      // ‚ùå already attempted ‚Üí DO NOT overwrite admin data
      return false;
    }

    // ‚úÖ first attempt only
    return ref.set(payload);
  });
}

function saveAttemptHistory(payload) {
  const ref = db.ref(
    "attempt_history/" +
    payload.quizId + "/" +
    payload.deviceId + "/" +
    payload.submittedAt
  );
  return ref.set(payload);
}

// üî• FIREBASE: RANK + PERCENTILE (SCORE ‚Üì, TIME ‚Üë)
function getRankAndPercentile(quizId, myScore, myTime, mySubmittedAt) {
  return db
    .ref("attempt_history/" + quizId)
    .once("value")
    .then(snapshot => {
      const quizData = snapshot.val() || {};
      let attempts = [];

      // collect ALL attempts from ALL devices
      Object.values(quizData).forEach(deviceAttempts => {
        Object.values(deviceAttempts).forEach(attempt => {
          attempts.push(attempt);
        });
      });

      // sort: score desc, time asc
      attempts.sort((a, b) => {
        if (b.score !== a.score) return b.score - a.score;
        return a.timeTaken - b.timeTaken;
      });

      const total = attempts.length;

      let rank = total + 1;
      for (let i = 0; i < attempts.length; i++) {
        if (
          attempts[i].score === myScore &&
          attempts[i].timeTaken === myTime &&
          attempts[i].submittedAt === mySubmittedAt
        ) {

          rank = i + 1;
          break;
        }
      }

      const below = attempts.filter(
        a =>
          a.score < myScore ||
          (a.score === myScore && a.timeTaken > myTime)
      ).length;

      const percentile = total
        ? ((below / total) * 100).toFixed(2)
        : "0.00";

      return { rank, percentile, total };
    });
}

// üî• LIVE rank recalculation for PREVIOUS attempts
function getLiveRankForAttempt(quizId, attempt) {
  return db.ref("attempt_history/" + quizId)
    .once("value")
    .then(snapshot => {
      const quizData = snapshot.val() || {};
      let attempts = [];

      Object.values(quizData).forEach(deviceAttempts => {
        Object.values(deviceAttempts).forEach(a => {
          attempts.push(a);
        });
      });

      // SAME SORT LOGIC (score ‚Üì, time ‚Üë)
      attempts.sort((a, b) => {
        if (b.score !== a.score) return b.score - a.score;
        return a.timeTaken - b.timeTaken;
      });

      const total = attempts.length;

      let rank = total;
      for (let i = 0; i < attempts.length; i++) {
        if (attempts[i].submittedAt === attempt.submittedAt) {
          rank = i + 1;
          break;
        }
      }

      const below = attempts.filter(
        a =>
          a.score < attempt.score ||
          (a.score === attempt.score && a.timeTaken > attempt.timeTaken)
      ).length;

      const percentile = total
        ? ((below / total) * 100).toFixed(2)
        : "0.00";

      return { rank, percentile, total };
    });
}

/* data from Jinja */
const QUESTIONS = [
{"question": "Read the following statements regarding the ‚ÄòDoctrine of Repugnancy‚Äô (Article 254):<br>Statement I: If a ‚ÄòState law‚Äô on a ‚ÄúConcurrent List‚Äù subject conflict with a ‚ÄòUnion law‚Äô, then the Union law prevails, and the State law becomes ‚Äòvoid‚Äô to the extent of the repugnancy.<br>Statement II: A State law on a Concurrent subject that conflicts with a Union law can still prevail within that State if it has been reserved for and received the assent of the President.<br>Which of the above statements is/are correct?", "option_1": "(a) Only Statement II is correct", "option_2": "(b) Both Statements I and II are correct", "option_3": "(c) Only Statement I is correct", "option_4": "(d) Neither Statement I nor II is correct", "option_5": "", "answer": "2", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50001", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "The Second Five Year Plan (1956-1961), often associated with the Mahalanobis Model, marked a significant shift in India's development strategy. What was the primary focus of this plan?", "option_1": "(a) Maximizing the role of the private sector in the 'commanding heights' of the economy.", "option_2": "(b) Achieving immediate self-sufficiency in food grain production through the Green Revolution.", "option_3": "(c) Establishing an export-oriented economy to integrate rapidly with global trade markets.", "option_4": "(d) Rapid industrialization with a particular emphasis on the development of basic and heavy industries.", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50002", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "The 'Fortaleza Declaration' of 2014 is most famous in BRICS history for the creation of which of the following?", "option_1": "(a) The BRICS Space Agency", "option_2": "(b) A common BRICS currency called 'R5'", "option_3": "(c) The Contingent Reserve Arrangement (CRA)", "option_4": "(d) A permanent BRICS Secretariat in Brazil", "option_5": "", "answer": "3", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50003", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which of the following was a primary objective of Alauddin Khilji's 'Market Control' (Zawabit) regulations?", "option_1": "(a) To expand treasury revenue by encouraging unrestricted trade with neighboring regions.", "option_2": "(b) To replace religious taxation with a uniform system of commercial levies across markets.", "option_3": "(c) To keep essential commodity prices low so soldiers could be maintained on fixed salaries.", "option_4": "(d) To promote overseas trade by encouraging Indian textile exports to foreign empires.", "option_5": "", "answer": "3", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50004", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "From a macroeconomic perspective, which indicator best captures the government's borrowing requirement excluding interest payments on past debt?", "option_1": "(a) Revenue deficit", "option_2": "(b) Fiscal deficit", "option_3": "(c) Primary deficit", "option_4": "(d) Budget deficit", "option_5": "", "answer": "3", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50005", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which of the following biological processes explains why human muscles often feel sore or ‚Äòcramped‚Äô after a sudden, intense bout of physical exercise?", "option_1": "(a) Accumulation of Ethyl Alcohol", "option_2": "(b) Excessive release of Carbon Dioxide", "option_3": "(c) Depletion of Vitamin C", "option_4": "(d) Accumulation of Lactic Acid", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50006", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Read the below statements:<br>Statement I) The 'Zoji La pass' serves as a very important link between the Kashmir Valley and the Ladakh region, cutting through the Great Himalayan Range.<br>Statement II) The 'Shipki La pass' is located in Arunachal Pradesh and serves as a primary gateway for the river Brahmaputra to enter India from Tibet.<br>Which of the above statements is/are correct?", "option_1": "(a) Both Statement I and II are correct", "option_2": "(b) Neither Statement I nor II is correct", "option_3": "(c) Only Statement I is correct", "option_4": "(d) Only Statement II is correct", "option_5": "", "answer": "3", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50007", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Regarding the legal protection of Dugong (Sea Cow) in India, consider the following statements<br>1 The Dugong is protected under Schedule I of the Wildlife (Protection) Act, 197<br>2 This classification provides the Dugong with the highest level of legal protection, similar to that of the Tiger<br>Which of the statements given above is/are correct?", "option_1": "(a) Both Statement 1 and Statement 2", "option_2": "(b) Only Statement 2", "option_3": "(c) Only Statement 1", "option_4": "(d) Neither Statement 1 nor Statement 2", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50008", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "In a standard FIBA (International) game, how many quarters are played, and how long is each quarter?", "option_1": "(a) Four 10-minute quarters", "option_2": "(b) Four 12-minute quarters", "option_3": "(c) Two 20-minute halves", "option_4": "(d) Four 8-minute quarters", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50009", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which of the following correctly describes the NISAR mission?", "option_1": "(a) ISRO-only mission for X-band radar mapping", "option_2": "(b) NASA-only mission for ultraviolet astronomy", "option_3": "(c) Optical imaging mission for exoplanet detection", "option_4": "(d) Joint ISRO-NASA mission using L and S-band radar", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50010", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Read the below statements regarding Aman Sehrawat's performance at the Paris 2024 Olympics:<br>Statement I: Aman Sehrawat won the bronze medal in the Men's 57kg freestyle wrestling event by defeating Darian Cruz of Puerto Rico.<br>Statement II: With this win, at the age of 21 years and 24 days, he surpassed PV Sindhu to become India's youngest-ever individual Olympic medalist.<br>Which of the following is correct?", "option_1": "(a) Neither statement I nor II is correct", "option_2": "(b) Only statement I is correct", "option_3": "(c) Only statement II is correct", "option_4": "(d) Both statements I and II are correct", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50011", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "What constitutes the primary objective of the Gyan Bharatam Mission?", "option_1": "(a) Promoting Indian languages globally", "option_2": "(b) Developing new libraries across India", "option_3": "(c) Translating classical texts into modern languages", "option_4": "(d) Preserving, digitizing, and disseminating India's manuscript heritage", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50012", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which indicator is used to measure the 'Knowledge' dimension of the Human Development Index?", "option_1": "(a) Adult literacy rate and primary school enrollment", "option_2": "(b) Mean years of schooling and Expected years of schooling", "option_3": "(c) Student-to-teacher ratio in secondary education", "option_4": "(d) Number of universities and research publications", "option_5": "", "answer": "2", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50013", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Regarding the 'Subsidiary Alliance' system introduced by Lord Wellesley (1798-1805), which of the following statements is INCORRECT?", "option_1": "(a) The ruler was free to employ any European (French, Portuguese, etc.) as long as they were not in active conflict with the British.", "option_2": "(b) If the ruler failed to make payments for the maintenance of the British force, a portion of his territory was ceded as a penalty.", "option_3": "(c) The Indian ruler was required to disband his own military and maintain a permanent British contingent within his territory.", "option_4": "(d) The British promised not to interfere in the internal administrative affairs of the allied state.", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50014", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Consider the following statements regarding the current Vice President of India<br>Statement 1: Chandrapuram Ponnusami (C.P.) Radhakrishnan is the Vice President of India, took charge on 12th September 2025<br>Statement 2: Unlike the Presidential election, the electoral college for the Vice President includes nominated members of both Houses of Parliament<br>Which of the statements above is/are correct?", "option_1": "(a) Both Statements 1 and 2 are correct", "option_2": "(b) Only statement 1 is correct", "option_3": "(c) Neither Statement 1 nor 2 is correct", "option_4": "(d) Only statement 2 is correct", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50015", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which of the following was a primary objective of 'Liberalization' within the New Economic Policy (NEP) of 1991?", "option_1": "(a) Strengthening the MRTP Act to restrict the expansion of large business houses.", "option_2": "(b) Expanding the list of industries reserved exclusively for the public sector.", "option_3": "(c) Increasing the peak customs duty on imports to protect domestic industries.", "option_4": "(d) Abolishing industrial licensing for most industries to encourage private entry.", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50016", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which of the following pairs of minerals and its leading producing state in India is correctly matched?", "option_1": "(a) Bauxite - Odisha", "option_2": "(b) Copper - Uttar Pradesh", "option_3": "(c) Mica - Rajasthan", "option_4": "(d) Limestone - Jharkhand", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50017", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Match List-I (Schedules) with List-II (Provisions/Functionaries) and select the correct answer using the codes given below<br>List-I (Schedule)-  A Second Schedule B- Third Schedule- C Fourth Schedule- D Seventh Schedule                                                                                                   List-II (Specific Provisions/Functionaries -1 Forms of Oaths for Union Ministers and Judges of SC/HC- 2 Emoluments and Privileges of the President and Governors- 3 Allocation of seats in the Council of States (Rajya Sabha)- 4Division of legislative powers between the Union and State governments", "option_1": "(a) A-2, B-1, C-3, D-4", "option_2": "(b) A-2, B-3, C-1, D-4", "option_3": "(c) A-4, B-1, C-3, D-2", "option_4": "(d) A-1, B-2, C-4, D-3", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50018", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Who was awarded the 2025 Pulitzer Prize for Fiction for a novel that serves as a provocative and satirical reimagining of the life of Jim from Mark Twain's 'Adventures of Huckleberry Finn'?", "option_1": "(a) Percival Everett", "option_2": "(b) Colson Whitehead", "option_3": "(c) Paul Lynch", "option_4": "(d) Hernan Diaz", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50019", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which historical process is best reflected by the evolution of temple architecture in India?", "option_1": "(a) Decline of indigenous art", "option_2": "(b) Continuous interaction of religion and regional styles", "option_3": "(c) Sudden cultural change", "option_4": "(d) Foreign architectural dominance", "option_5": "", "answer": "2", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50020", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "India hosted the 2025 Men's FIH Hockey Junior World Cup. Which of the following correctly states the location, host city name, and timing of this event?", "option_1": "(a) Bhubaneswar, Odisha, from November 15 to November 30, 2025", "option_2": "(b) Lucknow, Uttar Pradesh, from December 1 to December 15, 2025", "option_3": "(c) Chennai and Madurai, Tamil Nadu, from November 28 to December 10, 2025", "option_4": "(d) New Delhi, at Major Dhyan Chand National Stadium, from December 20 to December 31, 2025", "option_5": "", "answer": "3", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50021", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Read the below statements:<br>1  NASA launched a space telescope, SPHEREx, to study the universe‚Äôs ‚Äúcosmic glow‚Äù.<br>2  The Major Atmospheric Cherenkov Experiment (MACE) telescope was inaugurated at Hanle, Ladakh.<br>Which of the above statements is/are correct?", "option_1": "(a) Only statement 2", "option_2": "(b) Neither statement 1 nor 2", "option_3": "(c) Statement 1 and 2 both", "option_4": "(d) Only statement 1", "option_5": "", "answer": "3", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50022", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Which of the following statements regarding 'Navroz' (Nowruz) is correct?", "option_1": "(a) It is a lunar-based festival celebrated exclusively by the Buddhist community in the Himalayan belt.", "option_2": "(b) It marks the start of the harvest season in Southern India and is dedicated to the Sun God.", "option_3": "(c) It is a monsoon festival commemorating the victory of Good over Evil in the Mughal courts.", "option_4": "(d) It is the Persian New Year celebrated on the Spring Equinox, introduced in India by Ghiyasuddin Balban.", "option_5": "", "answer": "4", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50023", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Regarding 'Hit and Run' cases under Section 106(2) of the Bharatiya Nyaya Sanhita, 2023 (BNS), what is the maximum punishment if an offender causes death by rash and negligent driving and fails to inform a 'police officer' or 'Magistrate'?", "option_1": "(a) Imprisonment up to 10 years and a fine", "option_2": "(b) Life imprisonment", "option_3": "(c) Imprisonment up to 7 years and a fine", "option_4": "(d) Imprisonment up to 5 years and a fine", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50024", "quiz_id": "GS  GK CGL MAINS ENGLISH"},
{"question": "Dr. Bhupen Hazarika is famously known by which of the following titles, reflecting his deep connection to the geography and spirit of Assam?", "option_1": "(a) Bard of Brahmaputra", "option_2": "(b) Son of Brahmaputra", "option_3": "(c) Kala Guru of Assam", "option_4": "(d) Voice of Brahmaputra", "option_5": "", "answer": "1", "solution_text": "", "correct_score": "3", "negative_score": "1", "deleted": "0", "difficulty_level": "0", "option_image_1": "", "option_image_2": "", "option_image_3": "", "option_image_4": "", "option_image_5": "", "question_image": "", "solution_heading": "", "solution_image": "", "solution_video": "", "sortingparam": "0.00", "id": "50025", "quiz_id": "GS  GK CGL MAINS ENGLISH"}
];

let current = 0;
let answers = {};            // { questionId: "1", ... }
let markedForReview = new Set(); // Set of question indices marked for review
let ALL_ATTEMPTS_CACHE = {};
let LAST_RESULT_HTML = "";
let seconds = 1500; //  countdown
const TOTAL_TIME_SECONDS = seconds;
let isQuiz = false;
let timerInterval = null;

function saveQuizState(){
  const state = {
    current,
    answers,
    seconds,
    markedForReview: Array.from(markedForReview)
  };
  localStorage.setItem(QUIZ_STATE_KEY, JSON.stringify(state));
}

const el = id => document.getElementById(id);

function rebindResultHeaderActions() {
  const header = document.getElementById("headerControls");
  if (!header) return;

  header.querySelectorAll("button").forEach(btn => {
    const txt = btn.textContent.trim();

    if (txt === "Re-Attempt") {
      btn.onclick = () => {
        localStorage.removeItem(QUIZ_RESULT_KEY);
        localStorage.removeItem(QUIZ_STATE_KEY);
        location.reload();
      };
    }

    if (txt === "Previous Attempts") {
      btn.onclick = () => {
        const res = document.getElementById("results");
        res.innerHTML = "";
        res.style.display = "block";
        loadPreviousAttempts("GS  GK CGL MAINS ENGLISH", DEVICE_ID);
      };
    }

    if (txt === "Back to Latest Result") {
      btn.onclick = () => {
        document.getElementById("results").innerHTML = LAST_RESULT_HTML;
        document.getElementById("results").style.display = "block";
      };
    }
  });
}

/* format mm:ss */
function fmt(s){
  const m = Math.floor(s/60);
  const sec = s%60;
  return `${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
}

/* Timer */
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);

  // show initial time immediately
  el("timer").textContent = fmt(seconds);
  saveQuizState();

  timerInterval = setInterval(()=>{
    if(seconds <= 0){
      clearInterval(timerInterval);
      el("timer").textContent = "00:00";

      // auto submit when time is over (optional)
      try {
        document.getElementById("submitBtn")?.click();
      } catch(e){}

      return;
    }

    seconds--;
    el("timer").textContent = fmt(seconds);
  }, 1000);
}

/* initialize */
function init(){
  if (!__QUIZ_OK) return;

  el("qtotal").textContent = QUESTIONS.length;

  // üî• CHECK IF QUIZ ALREADY SUBMITTED
  const resultSaved = localStorage.getItem(QUIZ_RESULT_KEY);
  if (resultSaved) {
    const data = JSON.parse(resultSaved);

    if (data.submitted && data.resultHTML) {

      // hide quiz UI
      el("quizCard").style.display = "none";
      el("floatBar").style.display = "none";
      document.getElementById("studentNameContainer")?.style.setProperty("display", "none");

      // restore results
      const res = document.getElementById("results");
      res.innerHTML = data.resultHTML;
      res.style.display = "block";
      renderMath();

      // üî• RESTORE HEADER BUTTONS
      if (data.headerHTML) {
        document.getElementById("headerControls").innerHTML = data.headerHTML;
        rebindResultHeaderActions(); // ‚úÖ REQUIRED FIX
      }

      return; // ‚ùå STOP QUIZ INIT
    }
  }

  // üîÅ NORMAL QUIZ RESUME FLOW
  const saved = localStorage.getItem(QUIZ_STATE_KEY);
  if (saved) {
    const state = JSON.parse(saved);
    current = state.current ?? 0;
    answers = state.answers ?? {};
    seconds = state.seconds ?? seconds;
    if (state.markedForReview) {
      markedForReview = new Set(state.markedForReview);
    }
  }

  renderQuestion(current);
  startTimer();
  attachListeners();
  buildPalette();
  highlightPalette();
  renderMath();
}

/* render question */
function renderQuestion(i){
  if (!__QUIZ_OK) return;
  current = i;
  const q = QUESTIONS[i];
  el("qindex").textContent = i+1;
  el("qtext").innerHTML = q.question || "";
  normalizeMathForQuiz(el("qtext"));
  renderMath();
  el("marking").innerHTML = `Marking: <span style="color:var(--success)">+${Number(q.correct_score ?? 1)}</span> / <span style="color:var(--danger)">-${Number(q.negative_score ?? 0)}</span>`;
  const opts = el("options");
  opts.innerHTML = "";
  el("explanation").style.display = "none";

  const keys = ["option_1","option_2","option_3","option_4","option_5"];
  keys.forEach((k, idx) => {
    if(!q[k]) return;
    const div = document.createElement("div");
    div.className = "opt";
    div.innerHTML = `
    <div class="custom-radio" aria-hidden="true"></div>
    <div class="opt-text" style="flex:1">${q[k]}</div>
    `;
    opts.appendChild(div);

    // üî• NORMALIZE MATH IN OPTION TEXT
    normalizeMathForQuiz(div.querySelector(".opt-text"));

    div.addEventListener("click", () => selectOption(q, idx+1, div));

    // if previously answered, mark selected
    const qid = q.id ?? i;
    if(answers[qid] === String(idx+1)) div.classList.add("selected");
  });

  highlightPalette();
  renderMath();
  saveQuizState();
}

/* selecting option */
function selectOption(q, val, div){
  const qid = q.id ?? current;
  answers[qid] = String(val);
  // clear previous selections visually
  Array.from(el("options").children).forEach(o => o.className = "opt");
  div.classList.add("selected");
  // immediate feedback in quiz mode
  if(isQuiz) showFeedback(q, val);
  highlightPalette();
  saveQuizState();
}

/* show correct/wrong coloring and explanation */
function showFeedback(q, val){
  const opts = Array.from(el("options").children);
  opts.forEach((o, idx) => {
    o.classList.remove("correct","wrong");
    const idx1 = idx+1;
    if(String(q.answer) === String(idx1)){
      o.classList.add("correct");
    } else if(String(val) === String(idx1)){
      o.classList.add("wrong");
    }
  });
  if(q.solution_text){
    el("explanation").innerHTML = `<strong>Explanation:</strong> ${q.solution_text}`;
    el("explanation").style.display = "block";
    normalizeMathForQuiz(el("explanation"));
    renderMath();
  }
}

function loadPreviousAttempts(quizId, deviceId) {
  const box = document.getElementById("previousAttempts");
  box.innerHTML = "";
  normalizeMathForQuiz(box);
  renderMath();
  box.style.display = "block";

  document.getElementById("results").style.display = "none";
  document.getElementById("attemptReplay").style.display = "none";

  db.ref("attempt_history/" + quizId + "/" + deviceId)
    .once("value")
    .then(snapshot => {
      const data = snapshot.val();
      if (!data) {
        box.innerHTML = "<p>No previous attempts found.</p>";
        return;
      }
      ALL_ATTEMPTS_CACHE = data;

      const attempts = Object.values(data)
        .sort((a, b) => b.submittedAt - a.submittedAt);

      let html = `<div class="card"><h3 style="color:var(--accent)">Previous Attempts</h3>`;

      attempts.forEach((a, i) => {
        html += `
          <button class="btn-ghost" onclick="showAttempt('${a.submittedAt}')">
            Attempt ${attempts.length - i} ‚Äî ${a.score}
          </button>
        `;
      });

      html += "</div>";
      box.innerHTML = html;
      normalizeMathForQuiz(box);
      renderMath();
    });
}

function showAttempt(submittedAt) {
  const attempt = ALL_ATTEMPTS_CACHE[submittedAt];
  if (!attempt) return;

  const box = document.getElementById("attemptReplay");
  box.innerHTML = "";
  normalizeMathForQuiz(box);
  renderMath();
  box.style.display = "block";

  document.getElementById("previousAttempts").style.display = "none";
  document.getElementById("results").style.display = "none";

  let html = `
    <div class="card">
      <h3 style="color:var(--accent)">Attempt Review</h3>
      <div class="stats">
        <div class="stat"><h4>Score</h4><p>${attempt.score}</p></div>
        <div class="stat"><h4>Correct</h4><p>${attempt.correct}</p></div>
        <div class="stat"><h4>Wrong</h4><p>${attempt.wrong}</p></div>
        <div class="stat"><h4>Time Taken</h4><p>${fmt(attempt.timeTaken)}</p></div>
        <div class="stat"><h4>Rank</h4><p id="live-rank">...</p></div>
        <div class="stat"><h4>Percentile</h4><p id="live-percentile">...</p></div>
      </div>
    </div>
  `;

  attempt.answers.forEach((q, i) => {
    html += `<div class="card">
      <div style="font-weight:600;margin-bottom:6px">
        Q${i + 1}: ${q.question}
      </div>`;

    q.options.forEach((opt, idx) => {
      const id = String(idx + 1);
      let style = "padding:8px;border-radius:6px;margin:6px 0;border:1px solid #ddd;";
      if (id === q.correctAnswer) style += "border:2px solid var(--success);background:#eaf7f0;";
      else if (id === q.userAnswer) style += "border:2px solid var(--danger);background:#fdecec;";
      html += `<div style="${style}">${opt}</div>`;
    });

    html += "</div>";
  });

  box.innerHTML = html;
  normalizeMathForQuiz(box);
  renderMath();
  getLiveRankForAttempt("GS  GK CGL MAINS ENGLISH", attempt)
  .then(data => {
    document.getElementById("live-rank").textContent =
      `${data.rank} / ${data.total}`;
    document.getElementById("live-percentile").textContent =
      `${data.percentile}%`;
  });
}

/* Submit flow */
function submitQuiz(){
  // üîí NAME CHECK
  const nameInput = document.getElementById("studentName");
  if (!nameInput || !nameInput.value.trim()) {
    alert("Please enter your name to submit quiz");
    nameInput?.focus();
    return; // ‚ùå STOP SUBMIT, GO BACK TO QUIZ
  }

  // stop timer
  if(timerInterval) clearInterval(timerInterval);
  const timeTakenSeconds = TOTAL_TIME_SECONDS - seconds;

  let correct = 0, wrong = 0, totalMarks = 0;
  let attemptedCount = 0;
  
  QUESTIONS.forEach((q, i) => {
    const qid = q.id ?? i;
    const ans = answers[qid];
    if (ans) attemptedCount++;
    
    const isCorrect = ans && String(ans) === String(q.answer);
    if(isCorrect) correct++;
    else if(ans) wrong++;
    
    const cs = Number(q.correct_score ?? 1);
    const ns = Number(q.negative_score ?? 0);
    if(isCorrect) totalMarks += cs;
    else if(ans) totalMarks -= ns;
  });
  
  // ‚úÖ STEP 1: calculate maximum total marks
  let maxTotalMarks = 0;
  QUESTIONS.forEach(q => {
    maxTotalMarks += Number(q.correct_score ?? 1);
  });

  const attempted = Object.keys(answers).length;
  const unattempted = QUESTIONS.length - attempted;
  const accuracy = attempted ? ((correct/attempted) * 100).toFixed(1) : "0.0";

  // build review HTML
  let reviewHTML = `<div class="card"><h3 style="color:var(--accent);margin:0 0 10px">Results Summary</h3>
    <div class="stats">
      <div class="stat"><h4>Correct</h4><p>${correct}</p></div>
      <div class="stat"><h4>Wrong</h4><p>${wrong}</p></div>
      <div class="stat"><h4>Unattempted</h4><p>${unattempted}</p></div>
      <div class="stat"><h4>Accuracy</h4><p>${accuracy}%</p></div>
      <div class="stat"><h4>Total Marks</h4><p>${totalMarks} / ${maxTotalMarks}</p></div>
      <div class="stat"><h4>Time Taken</h4><p>${fmt(timeTakenSeconds)}</p></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:10px 0">
      <button class="btn-ghost" onclick="filterResults('all')">ALL</button>
      <button class="btn-ghost" onclick="filterResults('correct')">CORRECT</button>
      <button class="btn-ghost" onclick="filterResults('wrong')">WRONG</button>
      <button class="btn-ghost" onclick="filterResults('unattempted')">UNATTEMPTED</button>
    </div>

</div></div>`;

  QUESTIONS.forEach((q,i)=>{
    const qid = q.id ?? i;
    const ans = answers[qid];
    const isCorrect = ans && String(ans) === String(q.answer);
    const cs = Number(q.correct_score ?? 1);
    const ns = Number(q.negative_score ?? 0);

    const status = !ans ? "unattempted" : (isCorrect ? "correct" : "wrong");
    reviewHTML += `<div class="card result-q" data-status="${status}"><div style="font-weight:700;margin-bottom:8px">Q${i+1}: ${q.question}</div>`;
    ["option_1","option_2","option_3","option_4","option_5"].forEach((k,j)=>{
      if(!q[k]) return;
      const idx = j+1;
      const isOptCorrect = String(idx) === String(q.answer);
      const isUser = ans && String(idx) === String(ans);
      let style = "padding:8px 10px;margin:6px 0;border-radius:8px;";
      if(isOptCorrect) style += "border:2px solid var(--success);background:rgba(31,158,90,0.12);";
      else if(isUser && !isOptCorrect) style += "border:2px solid var(--danger);background:rgba(200,45,63,0.12);";
      else style += "border:1px solid #eee;background:#fafbfd;";
      reviewHTML += `<div style="${style}">${q[k]}</div>`;
    });
    const score = isCorrect ? `<span style="color:var(--success)">+${cs}</span>` : (ans ? `<span style="color:var(--danger)">-${ns}</span>` : `<span style="color:var(--muted)">0</span>`);
    reviewHTML += `<div style="margin-top:8px"><strong>Score:</strong> ${score}</div>`;
    if(q.solution_text) reviewHTML += `<div class="explanation" style="display:block;margin-top:8px"><strong>Explanation:</strong> ${q.solution_text}</div>`;
    reviewHTML += `</div>`;
  });

  el("results").innerHTML = reviewHTML;
  normalizeMathForQuiz(el("results"));
  renderMath();
  el("results").style.display = "block";

  el("quizCard").style.display = "none";
  // hide bottom nav and name input
  el("floatBar").style.display = "none";
  document.getElementById("studentNameContainer").style.display = "none";
  LAST_RESULT_HTML = reviewHTML; // ‚úÖ FIX: store latest result immediately

  document.getElementById("mainHeader")?.style.setProperty("display", "block");

  const timeTaken = timeTakenSeconds;

  const firebasePayload = {
    name: document.getElementById("studentName")?.value || "Anonymous",
    score: totalMarks,
    total: maxTotalMarks,
    correct,
    wrong,
    unattempted,
    timeTaken,
    quizId: "GS  GK CGL MAINS ENGLISH",
    deviceId: DEVICE_ID,
    submittedAt: Date.now(),
    answers: QUESTIONS.map((q, i) => {
      const qid = q.id ?? i;
      return {
        question: q.question,
        options: [
          q.option_1,
          q.option_2,
          q.option_3,
          q.option_4,
          q.option_5
        ].filter(Boolean),
        correctAnswer: String(q.answer),
        userAnswer: answers[qid] ?? null
      };
    })
  };

  // üî• ADMIN DATA (first attempt only)
  saveResultFirebase(firebasePayload)
    .finally(() => {
      saveAttemptHistory(firebasePayload);

      // üî• RESULT PAGE (always show rank, even on reattempt)
      getRankAndPercentile("GS  GK CGL MAINS ENGLISH", totalMarks, timeTaken, firebasePayload.submittedAt)
        .then(data => {

          firebasePayload.rank = data.rank;
          firebasePayload.percentile = data.percentile;

          // üî• UPDATE THIS ATTEMPT WITH RANK & PERCENTILE
          db.ref(
          "attempt_history/" +
          firebasePayload.quizId + "/" +
          firebasePayload.deviceId + "/" +
          firebasePayload.submittedAt
          ).update({
          rank: data.rank,
          percentile: data.percentile
          });

          const rankHTML = `
            <div class="stat">
              <h4>Rank</h4>
              <p>${data.rank} / ${data.total}</p>
            </div>
            <div class="stat">
              <h4>Percentile</h4>
              <p>${data.percentile}%</p>
            </div>
          `;

          document
            .querySelector("#results .stats")
            ?.insertAdjacentHTML("beforeend", rankHTML);
            setTimeout(() => {
              const finalResultHTML = document.getElementById("results").innerHTML;
              const headerHTML = document.getElementById("headerControls").innerHTML;

              LAST_RESULT_HTML = finalResultHTML;

              // üîê SAVE COMPLETE RESULT + HEADER STATE
              localStorage.setItem(QUIZ_RESULT_KEY, JSON.stringify({
                submitted: true,
                resultHTML: finalResultHTML,
                headerHTML: headerHTML
              }));
            }, 0);
        });
    });

  // replace header controls with results controls (Re-Attempt, Download, Print)
  const header = el("headerControls");
  header.innerHTML = "";
  const left = document.createElement("div");
  left.style.display = "flex";
  left.style.alignItems = "center";
  left.style.gap = "10px";
  const title = document.createElement("h1");
  title.textContent = QUIZ_TITLE;
  left.appendChild(title);

  const right = document.createElement("div");
  right.style.display = "flex";
  right.style.alignItems = "center";
  right.style.gap = "10px";

  const retry = document.createElement("button");
  retry.className = "btn";
  retry.textContent = "Re-Attempt";
  retry.onclick = ()=> {
    localStorage.removeItem(QUIZ_RESULT_KEY);
    localStorage.removeItem(QUIZ_STATE_KEY);
    location.reload();
  };

  right.appendChild(retry);
  const prevBtn = document.createElement("button");
  prevBtn.className = "btn-ghost";
  prevBtn.textContent = "Previous Attempts";
  prevBtn.onclick = () => {
    const res = document.getElementById("results");
    res.innerHTML = "";                    // clear latest result
    res.style.display = "block";
    loadPreviousAttempts("GS  GK CGL MAINS ENGLISH", DEVICE_ID);
  };

  const backBtn = document.createElement("button");
  backBtn.className = "btn-ghost";
  backBtn.textContent = "Back to Latest Result";
  backBtn.onclick = () => {
    document.getElementById("results").innerHTML = LAST_RESULT_HTML;
    document.getElementById("results").style.display = "block";
  };

  right.appendChild(prevBtn);
  right.appendChild(backBtn);

  // Download & Print intentionally disabled
  header.appendChild(left);
  header.appendChild(right);
}

/* Download current results page as .html named after quiz title */
function downloadResults(){
  const head = document.head.outerHTML;
  const resultsHtml = el("results").outerHTML;
  const pageHtml = `<!doctype html><html>${head}<body><div style="padding:20px;max-width:1000px;margin:auto">${resultsHtml}</div></body></html>`;
  const blob = new Blob([pageHtml], {type:"text/html"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  const safe = String(QUIZ_TITLE).replace(/[^a-z0-9]/gi,"_");
  a.href = url;
  a.download = `${safe}_results.html`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* attach DOM listeners */
function attachListeners(){
  el("nextBtn").addEventListener("click", ()=> { 
    if(current < QUESTIONS.length-1) renderQuestion(current+1); 
  });
  
  el("prevBtn").addEventListener("click", ()=> { 
    if(current > 0) renderQuestion(current-1); 
  });
  
  el("clearBtn").addEventListener("click", ()=> { 
    const qid = QUESTIONS[current].id ?? current;
    delete answers[qid];
    renderQuestion(current); 
    highlightPalette(); 
  });
  
  el("markReviewBtn").addEventListener("click", () => {
    if (markedForReview.has(current)) {
      markedForReview.delete(current);
    } else {
      markedForReview.add(current);
    }
    highlightPalette();
    saveQuizState();
  });
  
  el("saveNextBtn").addEventListener("click", () => {
    saveQuizState();
    if (current < QUESTIONS.length - 1) {
      renderQuestion(current + 1);
    }
  });

  el("paletteBtn").addEventListener("click", (e) => {
    e.stopPropagation();
    togglePalette();
  });

  el("submitBtn").addEventListener("click", ()=>{
    const attempted = Object.keys(answers).length;
    el("submitMsg").textContent = `You attempted ${attempted} of ${QUESTIONS.length}. Submit?`;
    el("submitModal").style.display = "flex";
  });

  el("cancelSubmit").addEventListener("click", ()=> el("submitModal").style.display = "none");
  el("confirmSubmit").addEventListener("click", ()=> { el("submitModal").style.display = "none"; submitQuiz(); });

  el("modeToggle").addEventListener("click", ()=> {
    el("modeToggle").classList.toggle("active");
    isQuiz = el("modeToggle").classList.contains("active");
    // re-render the current question so immediate behavior toggles
    renderQuestion(current);
  });

  // close palette when clicking outside
  document.addEventListener("click", (ev) => {
    const pal = el("palette");
    if(!pal) return;
    if(pal.style.display === "flex"){
      const viewBtn = el("paletteBtn");
      if(ev.target !== pal && !pal.contains(ev.target) && ev.target !== viewBtn && !viewBtn.contains(ev.target)){
        pal.style.display = "none";
      }
    }
  });
}

/* Build palette buttons + summary */
function buildPalette(){
  const pal = el("palette");
  pal.innerHTML = "";
  for(let i=0;i<QUESTIONS.length;i++){
    const b = document.createElement("button");
    b.className = "qbtn";
    b.textContent = i+1;
    b.addEventListener("click", (e)=>{
      e.stopPropagation();
      renderQuestion(i);
      pal.style.display = "none";
    });
    pal.appendChild(b);
  }
  const summary = document.createElement("div");
  summary.id = "palette-summary";
  summary.style.marginTop = "8px";
  pal.appendChild(summary);
  highlightPalette();
}

/* color palette buttons and show summary */
function highlightPalette(){
  const pal = el("palette");
  if(!pal) return;
  const total = QUESTIONS.length;
  const attempted = Object.keys(answers).length;
  const marked = markedForReview.size;
  const notAttempted = total - attempted - marked;
  
  Array.from(pal.children).forEach((child, idx) => {
    // skip summary
    if(child.id === "palette-summary") return;
    child.classList.remove("attempted", "unattempted", "marked", "current", "unseen");
    
    const qid = QUESTIONS[idx].id ?? idx;
    
    if(idx === current) {
      child.classList.add("current");
    } else if(markedForReview.has(idx)) {
      child.classList.add("marked");
    } else if(answers[qid]) {
      child.classList.add("attempted");
    } else {
      child.classList.add("unattempted");
    }
  });
  
  const summary = el("palette-summary");
  if(summary) {
    summary.innerHTML = `
      <div>Total: ${total}</div>
      <div style="color:var(--success)">Attempted: ${attempted}</div>
      <div style="color:var(--danger)">Unattempted: ${notAttempted}</div>
      <div style="color:var(--purple)">Marked: ${marked}</div>
    `;
  }
}

/* toggle palette visibility */
function togglePalette(){
  const pal = el("palette");
  if(pal.style.display === "flex") pal.style.display = "none";
  else { pal.style.display = "flex"; highlightPalette(); }
}

// üîê COPY + WATERMARK PROTECTION (DEPENDENCY TRAP)
(function () {

  // Disable right click
  document.addEventListener("contextmenu", e => e.preventDefault());

  // Disable common copy shortcuts
  document.addEventListener("keydown", function (e) {
    if (
      (e.ctrlKey || e.metaKey) &&
      ["c","x","v","a","s","p","u"].includes(e.key.toLowerCase())
    ) {
      e.preventDefault();
    }
  });

  // Ensure watermark always exists
  function ensureWatermark(){
    if(!document.getElementById("ssc-watermark")){
      document.body.innerHTML = "";
      alert("Quiz file modified");
      throw new Error("WATERMARK_REMOVED");
    }
  }

  ensureWatermark();
  setInterval(ensureWatermark, 2000);

})();

function filterResults(type){
  const cards = document.querySelectorAll(".result-q");
  cards.forEach(card=>{
    if(type === "all"){
      card.style.display = "block";
    } else {
      card.style.display = card.dataset.status === type ? "block" : "none";
    }
  });
}

/* start */
window.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>